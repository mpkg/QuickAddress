<!DOCTYPE html>
<html>
<head>
    <title>Places Autocomplete</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link href="/maps/documentation/javascript/examples/default.css" rel="stylesheet">
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"> </script>
    <!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" />-->
    <style>
        input
        {
            border: 1px solid rgba(0, 0, 0, 0.5);
        }
        input.notfound
        {
            border: 2px solid rgba(255, 0, 0, 0.4);
        }
    </style>
    <script type="text/javascript">
        var XrmObject = window.parent.Xrm;
        var addressInfo;

        function extractAddressComponents(addressComponents) {
            for (var i = 0; i < addressComponents.length; i++) {
                for (var j = 0; j < addressComponents[i].types.length; j++) {
                    switch (addressComponents[i].types[j]) {
                        case 'street_number':
                            if (addressInfo.line1)
                                addressInfo.line1 = addressInfo.line1 + ', ' + addressComponents[i].long_name;
                            else
                                addressInfo.line1 = addressComponents[i].long_name;
                            break;
                        case 'route':
                            if (addressInfo.line1)
                                addressInfo.line1 = addressInfo.line1 + ', ' + addressComponents[i].long_name;
                            else
                                addressInfo.line1 = addressComponents[i].long_name;
                            break;
                        case 'sublocality':
                            addressInfo.line2 = addressComponents[i].long_name;
                            break;
                        case 'locality':
                            addressInfo.line3 = addressComponents[i].long_name;
                            break;
                        case 'administrative_area_level_2':
                            addressInfo.city = addressComponents[i].long_name;
                            break;
                        case 'administrative_area_level_1':
                            addressInfo.state = addressComponents[i].long_name;
                            break;
                        case 'country':
                            addressInfo.country = addressComponents[i].long_name;
                            break;
                        case 'postal_code':
                            addressInfo.postalcode = addressComponents[i].long_name;
                            break;
                        default:
                            if (addressInfo.otherinfo)
                                addressInfo.otherinfo = addressInfo.otherinfo + ' ' + addressComponents[i].long_name;
                            else
                                addressInfo.otherinfo = addressComponents[i].long_name;
                    }
                }
            }
        }

        function initialize() {

            var input = /** @type {HTMLInputElement} */(document.getElementById('searchTextField'));
            var autocomplete = new google.maps.places.Autocomplete(input);

            var infowindow = new google.maps.InfoWindow();

            google.maps.event.addListener(autocomplete, 'place_changed', function () {
                infowindow.close();
                input.className = '';
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    // Inform the user that the place was not found and return.
                    input.className = 'notfound';
                    return;
                }

                var address = '';
                addressInfo = new Object();
                if (place.address_components) {
                    address = [
        (place.address_components[0] && place.address_components[0].short_name || ''),
        (place.address_components[1] && place.address_components[1].short_name || ''),
        (place.address_components[2] && place.address_components[2].short_name || '')
      ].join(' ');
                }

                if (place.address_components) {
                    if (place.international_phone_number)
                        addressInfo.phone = place.international_phone_number;
                    if (place.website)
                        addressInfo.website = place.website;
                    if (place.name)
                        addressInfo.name = place.name;
                    extractAddressComponents(place.address_components);

                    //Set Fields
                    XrmObject.Page.getAttribute('address1_name').setValue(addressInfo.name);
                    XrmObject.Page.getAttribute('address1_line1').setValue(addressInfo.line1);
                    XrmObject.Page.getAttribute('address1_line2').setValue(addressInfo.line2);
                    XrmObject.Page.getAttribute('address1_line3').setValue(addressInfo.line3);
                    XrmObject.Page.getAttribute('address1_city').setValue(addressInfo.city);
                    XrmObject.Page.getAttribute('address1_stateorprovince').setValue(addressInfo.state);
                    XrmObject.Page.getAttribute('address1_country').setValue(addressInfo.country);
                    XrmObject.Page.getAttribute('address1_postalcode').setValue(addressInfo.postalcode);
                    XrmObject.Page.getAttribute('address1_telephone1').setValue(addressInfo.phone);
                }

                infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            });

            // Sets a listener on a radio button to change the filter type on Places
            // Autocomplete.
            function setupClickListener(id, types) {
                var radioButton = document.getElementById(id);
                google.maps.event.addDomListener(radioButton, 'click', function () {
                    autocomplete.setTypes(types);
                });
            }

            setupClickListener('changetype-all', []);
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<body>
    <div id="panel">
        <table style="width: 100%;">
            <tr>
                <td>
                    <input id="searchTextField" type="text" size="50">
                    <input type="radio" name="type" id="changetype-all" checked="true" value="V1" style="visibility: hidden">
                </td>
            </tr>
            <!--<tr>
                <td>
                    <input id="street_number" type="text" />
                </td>
                <td>
                    <input id="route" type="text" />
                </td>
                <td>
                    <input id="locality" type="text" />
                </td>
            </tr>
            <tr>
                <td>
                    <input id="admin_area_level_2" type="text" />
                </td>
                <td>
                    <input id="admin_area_level_1" type="text" />
                </td>
                <td>
                    <input id="country" type="text" />
                </td>
            </tr>
            <tr>
                <td>
                    <input id="postal_code" type="text" />
                </td>
                <td>
                    <input id="international_phone_number" type="text" />
                </td>
                <td>
                    <input id="website" type="text" />
                </td>
            </tr>-->
        </table>
    </div>
</body>
</html>